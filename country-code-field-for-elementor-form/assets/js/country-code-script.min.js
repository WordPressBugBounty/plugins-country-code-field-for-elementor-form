class CCFEF extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{inputTelTextArea:"textarea.ccfef_country_code_data_js",intlInputSpan:".ccfef-editor-intl-input",submitButton:"div.elementor-field-type-submit button"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$textArea:this.$element.find(e.inputTelTextArea),$intlSpanElement:this.$element.find(e.intlInputSpan),$submitButton:this.$element.find(e.submitButton)}}bindEvents(){this.telId=new Array,this.includeCountries={},this.excludeCountries={},this.defaultCountry={},this.iti={},this.getIntlUserData(),this.appendCountryCodeHandler(),this.addCountryCodeInputHandler(),this.removeInputTelSpanEle(),this.intlInputValidation()}appendCountryCodeHandler(){this.telId.forEach(e=>{this.addCountryCodeIconHandler(e.formId,e.fieldId,e.customId)})}addCountryCodeIconHandler(e,t,n){const i=CCFEFCustomData.pluginDir+"assets/intl-tel-input/js/utils.min.js",l=jQuery(`.elementor-widget.elementor-widget-form[data-id="${e}"] .elementor-field-type-tel.elementor-field-group input[type="tel"]#${n}`)[0];if(void 0!==l){let n=[],o=[],r="in";const s=["in","us","gb","ru","fr","de","br","cn","jp","it"],d=`${e}${t}`;if(this.includeCountries.hasOwnProperty(d)&&this.includeCountries[d].length>0&&(r=this.includeCountries[d][0],n=this.includeCountries[d].map(e=>e)),this.excludeCountries.hasOwnProperty(d)&&this.excludeCountries[d].length>0){let e=s.filter(e=>!this.excludeCountries[d].includes(e));r=e[0],o=this.excludeCountries[d].map(e=>e)}this.defaultCountry[d]&&""!==this.defaultCountry[d]&&(r=this.defaultCountry[d]);const a=window.intlTelInput(l,{initialCountry:r,utilsScript:i,formatOnDisplay:!1,formatAsYouType:!0,autoFormat:!1,containerClass:"cfefp-intl-container",useFullscreenPopup:!1,onlyCountries:n,excludeCountries:o,customPlaceholder:function(e,t){let n=e;"in"===t.iso2&&(n=e.replace(/^0+/,""));const i=`+${t.dialCode} ${n}`;return i.replace(/\s/g,"")}});l.removeAttribute("pattern"),this.iti[e+t]=a}}addCountryCodeInputHandler(){const e=this.iti;Object.keys(e).forEach(t=>{const n=e[t],i=n.telInput;let l=n.getSelectedCountryData(),o=`+${l.dialCode}`,r=!1;const s=()=>{r=!1},d=e=>{const t=n.getSelectedCountryData(),i=`+${t.dialCode}`;if("keydown"===e.type||"input"===e.type)r=!0,clearTimeout(s),setTimeout(s,400),l.dialCode!==t.dialCode?l=t:l.dialCode===t.dialCode&&l.iso2!==t.iso2&&n.setCountry(l.iso2);else if("countrychange"===e.type){if(r)return;l=t}this.updateCountryCodeHandler(e.currentTarget,i,o),o=i};i.addEventListener("keydown",d),i.addEventListener("input",d),i.addEventListener("countrychange",d)})}updateCountryCodeHandler(e,t,n){let i=e.value;t&&"+undefined"===t||["","+"].includes(i)||(t!==n&&(i=i.replace(new RegExp(`^\\${n}`),"")),i.startsWith(t)||(i=i.replace(/\+/g,""),e.value=t+i))}removeInputTelSpanEle(){this.$element.find("span.ccfef-editor-intl-input").remove()}getIntlUserData(){const e=this.elements.$intlSpanElement,t=[];e.each((e,n)=>{const i=jQuery(n),l=i.data("include-countries"),o=i.data("exclude-countries"),r=i.data("defaultCountry"),s=i.data("id"),d=i.data("field-id"),a=i.closest(".elementor-element.elementor-widget-form").data("id"),u=`${a}${d}`;if(""!==l){const e=l.split(",");this.includeCountries[u]=e}if(""!==o){const e=o.split(",");this.excludeCountries[u]=e}""!==r&&(this.defaultCountry[u]=r),t.includes(u)||(this.telId.push({formId:a,fieldId:d,customId:s}),t.push(u))})}intlInputValidation(){this.elements.$submitButton.on("click",e=>{const t=this.iti;Object.keys(t).length>0&&Object.keys(t).forEach(n=>{const i=t[n],l=i.telInput;""!==l.value&&(l.value=l.value.replace(/[^0-9+]/g,""));const o=l.closest(".elementor-field-group"),r=o.querySelector(".cfefp-intl-container");r&&l.offsetHeight&&r.style.setProperty("--cfefp-intl-tel-button-height",`${l.offsetHeight}px`);const s=jQuery(l).parent();s.find("span.elementor-message").remove();const d=CCFEFCustomData.errorMap;let a='<span class="elementor-message elementor-message-danger elementor-help-inline elementor-form-help-inline" role="alert">';if(""!==l.value)if(i.isValidNumber())jQuery(l).closest(".cfefp-intl-container").removeClass("elementor-error");else{const t=i.getValidationError();void 0!==t&&d[t]&&(a+=d[t]+"</span>",jQuery(l).closest(".cfefp-intl-container").addClass("elementor-error"),jQuery(l).after(a),e.preventDefault())}})})}}jQuery(window).on("elementor/frontend/init",()=>{const e=e=>{elementorFrontend.elementsHandler.addHandler(CCFEF,{$element:e})};elementorFrontend.hooks.addAction("frontend/element_ready/form.default",e)});